{% extends 'base.html' %}
{% load staticfiles %}
{% load bootstrap3 %}


{% block titulo %}Gesti√≥n de empleados{% endblock titulo %}
{% block descripcion_pagina %} Gestiona los empleados CINEMAPP {% endblock descripcion_pagina %}
{% block miga_pan %}
<li><a href="{% url 'accounts:home'%}"><i class="fa fa-dashboard"></i> DASHBOARD</a></li>
<li class="active">GESTIONAR EMPLEADOS</li>
{% endblock miga_pan %}

{% block css %}
<link rel="stylesheet" href="{%  static 'bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css' %}">
<link href="{% static 'bower_components/datatables.net-bs/responsive/responsive.dataTables.min.css' %}" rel="stylesheet">
<link rel="stylesheet" href="{% static 'plugins/toastr/toastr.min.css' %}">
{{ form_empleado.media.css }}
<style media="screen">
    .select2-container {
        width: 100% !important;
    }
</style>
{% endblock css %}

{% block contenido %}

<div class="col-md-12">
    <div class="box box-primary">
        <div class="box-header">
            <h3 class="box-title">Registrar empleados</h3>
        </div>
        <div class="box-body">
            <form method="post" id="formulario" onsubmit="return validacion()" action="{% url 'accounts:registro' %}"> {% csrf_token %}

                <div class="row">
                    <div class="col-sm-4">
                        {% bootstrap_field form.first_name%}
                    </div>
                    <div class="col-sm-4">
                        {% bootstrap_field form.last_name%}
                    </div>
                    <div class="col-sm-2">
                        {% bootstrap_field form.cedula%}
                    </div>
                    <div class="col-sm-2">
                        {% bootstrap_field form.telefono%}
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-2">
                        {% bootstrap_field form.username%}
                    </div>
                    <div class="col-sm-4">
                        {% bootstrap_field form.email%}
                    </div>
                    <div class="col-sm-2">
                        {% bootstrap_field form_empleado.cargo%}
                    </div>
                    <div class="col-sm-4">
                        {% bootstrap_field form_empleado.sucursal%}
                    </div>
                </div>


                <div class="row">
                    <div class="col-md-8 col-md-offset-3">
                        <div class="col-sm-4">
                            {% bootstrap_field form.password1%}
                        </div>
                        <div class="col-sm-4">
                            {% bootstrap_field form.password2%}
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-success btn-raised" id="registrar">Registrar</button>
            </form>
        </div>
    </div>
</div>


<div class="col-md-12">
    <div class="box box-primary">
        <div class="box-header">
            <h3 class="box-title">Listado de empleados</h3>
        </div>
        <div class="box-body">
            <table id="tabla_empleados" class="table table-striped table-bordered table-responsive">
                <thead>
                <tr>
                    <th>Cedula</th>
                    <th>Nombres</th>
                    <th>Apellidos</th>
                    <th>Cargo</th>
                    <th>Sucursal</th>
                    <th>Usuario</th>
                    <th>Correo</th>
                    <th>Tel.</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
                </thead>
                <tbody>
                {% for empleado in empleados %}
                <tr>
                    <td>{{ empleado.user.cedula }}</td>
                    <td>{{ empleado.user.first_name }}</td>
                    <td>{{ empleado.user.last_name }}</td>
                    <td>{{ empleado.cargo }}</td>
                    <td>{{ empleado.sucursal.nombre }}</td>
                    <td>{{ empleado.user.username }}</td>
                    <td>{{ empleado.user.email }}</td>
                    <td>{{ empleado.user.telefono }}</td>
                    <td>
                        {%  if empleado.user.is_active %} <span class="badge bg-green">Activo</span>
                        {% else %} <span class="badge bg-red">Inactivo</span>
                        {% endif %}
                    </td>
                    <td><a href="{% url 'accounts:modificar_empleado' empleado.id %}">Editar Empleado</a>
                    </td>
                </tr>
                {% endfor %}

                </tbody>
            </table>

        </div>
    </div>
</div>


{% endblock contenido %}

{% block js %}

<script src="{% static 'bower_components/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js' %}"></script>
<script src="{% static 'bower_components/datatables.net-bs/responsive/dataTables.responsive.min.js' %}"></script>

<script type="text/javascript">
    const url_api = '{% url 'accounts:checkusername' %}';
    const token = '{{ csrf_token }}';
</script>
<script src="{% static 'dist/js/check_username.js' %}"></script>
<script src="{% static 'dist/js/validacion_registro_empleados.js' %}"></script>
<script src="{% static 'plugins/toastr/toastr.min.js' %}"></script>
{{ form_empleado.media.js }}
<script type="text/javascript">
    $(function () {
        $('#tabla_empleados').DataTable({
            "language": { "url": "{% static 'bower_components/datatables.net/spanish.json' %}" },
	        "responsive": true
        })
    })
</script>

<script type="application/javascript">

    $('#id_cargo').change(function(){

        var selector = document.getElementById('id_cargo');
        var id_cargo = selector[selector.selectedIndex].value;

        $.get('{% url 'accounts:get_sucursales_disponibles' %}', {"csrfmiddlewaretoken":'{{ csrf_token }}','id_cargo': id_cargo}, function(data){
            $('#id_sucursal').empty();
            $("#id_sucursal").select2({
                data: data.sucursales
            });
        });
    });
</script>

<script>
    {% for msg in messages %}
    $(document).ready(function () {
        setTimeout(function () {
            toastr.options = {
                "closeButtons": true,
                "progressBar": true,
                "preventDuplicates": true,
                "showEasing": "swing",
                "extendedTimeOut": 30000,
                "timeOut": 4000
            }
            toastr["{{ msg.tags }}"]("{{ msg }}")
        }, 500);
    });
    {% endfor %}
</script>

{% endblock js %}
