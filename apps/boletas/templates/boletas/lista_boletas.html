{% extends 'base.html' %}
{% load staticfiles %}
{% load bootstrap3 %}


{% block titulo %}Lista de boletas{% endblock titulo %}
{% block descripcion_pagina %} Lista las boletas vendidas en CINEMAPP {% endblock descripcion_pagina %}
{% block miga_pan %}
<li><a href="{% url 'accounts:home' %}"><i class="fa fa-dashboard"></i> DASHBOARD</a></li>
<li class="active">GESTIONAR BOLETAS</li>
{% endblock miga_pan %}

{% block css %}
<link rel="stylesheet" href="{% static 'bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css' %}">
<link href="{% static 'bower_components/datatables.net-bs/responsive/responsive.dataTables.min.css' %}"
	  rel="stylesheet">

<style media="screen">
	.select2-container {
		width: 100% !important;
	}

	.modal-dialog {
		position: relative;
		width: 30% !important;
		margin-left: 35%;
	}
</style>
{% endblock css %}


{% block contenido %}
<div class="col-md-12">
	<div class="box box-primary">
		<div class="box-header">
			<h3 class="box-title">Listado de Boletas</h3>
		</div>
		<div class="box-body">
			<table id="tabla_boletas" class="table table-striped table-bordered table-responsive">
				<thead>
				<tr>
					<th class="hidden">id</th>
					<th>Cédula</th>
					<th>Cliente</th>
					<th>Función</th>
					<th>Fecha/Hora de Función</th>
					<th>Silla</th>
					<th>Valor</th>
					<th>Fecha de Compra</th>
					<th>Pago</th>
					<th>Acciones</th>
				</tr>
				</thead>
				<tbody>
				{% for boleta in boletas %}
				<tr>
					<td id="id_boleta" class="hidden">{{boleta.id}}</td>
					<td>{{ boleta.cedula }}</td>
					<td>{{ boleta.nombre_cliente }}</td>
					<td><a href="{% url 'peliculas:ver_pelicula' boleta.funcion.pelicula.slug %}">{{ boleta.funcion.pelicula.nombre }}</a></td>
					<td>{{ boleta.funcion.fecha_funcion|date:"l d M Y" }} - {{ boleta.funcion.hora_funcion }}</td>
					<td>{{ boleta.silla.nombre }}</td>
					<td>${{ boleta.total }}</td>
					<td>{{ boleta.fecha_compra|date:"l d M Y" }}</td>
					<td>{{ boleta.medio_pago }}</td>
					{%  if boleta.cedula != "" %}
					<td><a class="cancelar-boleta" href="#">Cancelar Boleta</a></td>
					{% endif %}
				</tr>
				{% endfor %}

				</tbody>
			</table>
		</div>
	</div>
</div>
<!--modal-confirmacion-->
<div style="" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" id="mi-modal">
	<div class="modal-dialog modal-sm">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				<h4 class="modal-title" id="myModalLabel">Confirmar</h4>
			</div>
			<div class="modal-body">
				Está seguro que esea cancelar la boleta?
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-warning" id="modal-btn-no">No</button>
				<button type="button" class="btn btn-success" id="modal-btn-si">Si</button>
			</div>
		</div>
	</div>
</div>


{% endblock contenido %}

{% block js %}
<script src="{% static 'plugins/toastr/toastr.min.js' %}"></script>
<script src="{% static 'bower_components/datatables.net/js/jquery.dataTables.min.js' %}"></script>
<script src="{% static 'bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js' %}"></script>
<script src="{% static 'bower_components/datatables.net-bs/responsive/dataTables.responsive.min.js' %}"></script>
<script>
    $(function () {
        $('#tabla_boletas').DataTable()
    })

    var boleta;

    var modalConfirm = function(callback){

        $(".table tbody").on("click", ".cancelar-boleta", function(){

            var fila = $(this).closest("tr");
            boleta = fila.find("td:eq(0)").text();
            console.log(boleta)
            $("#mi-modal").modal('show');

        });

        $("#modal-btn-si").on("click", function(){
            callback(true);
            $("#mi-modal").modal('hide');
        });

        $("#modal-btn-no").on("click", function(){
            callback(false);
            $("#mi-modal").modal('hide');
        });
    };

    modalConfirm(function(confirm){

        if(confirm){

            $.get('{% url 'boletas:cancelar_boleta' %}', {"csrfmiddlewaretoken":'{{ csrf_token }}', 'boleta': boleta}, function(data){
                document.location.reload(true)
            });


        }
    });
</script>

{% endblock js %}