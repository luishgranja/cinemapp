{% extends 'base.html' %}
{% load staticfiles %}
{% load bootstrap3 %}


{% block titulo %}Gestión de peliculas{% endblock titulo %}
{% block descripcion_pagina %} Gestiona las peliculas CINEMAPP {% endblock descripcion_pagina %}
{% block miga_pan %}
	<li><a href="{% url 'accounts:home' %}"><i class="fa fa-dashboard"></i> DASHBOARD</a></li>
	<li class="active">GESTIONAR PELICULAS</li>
{% endblock miga_pan %}

{% block css %}
	<link rel="stylesheet" href="{% static 'bower_components/datatables.net-bs/css/dataTables.bootstrap.min.css' %}">
	<link href="{% static 'bower_components/datatables.net-bs/responsive/responsive.dataTables.min.css' %}"
	      rel="stylesheet">
	{{ form.media.css }}
	<style media="screen">
		.select2-container {
			width: 100% !important;
		}
	</style>
{% endblock css %}

{% block contenido %}

	<div class="col-md-12">
		<div class="box box-primary">
			<div class="box-header">
				<h3 class="box-title">Registrar peliculas</h3>
			</div>
			<div class="box-body">

				<form method="POST" id="formulario" onsubmit="return validacion_pelicula()"
				      action="{% url 'peliculas:crear' %}" enctype="multipart/form-data"> {% csrf_token %}

					<div class="row">
						<div class="col-sm-4">
							{% bootstrap_field form.nombre %}
						</div>
						<div class="col-sm-2">
							{% bootstrap_field form.nombre_director %}
						</div>
						<div class="col-sm-6">
							{% bootstrap_field form.reparto %}
						</div>
					</div>

					<div class="row">
						<div class="col-sm-5">
							{% bootstrap_field form.sinopsis %}
						</div>
						<br><br><br>
						<div class="col-sm-5">
							{% bootstrap_field form.genero %}
						</div>
						<div class="col-sm-2">
							{% bootstrap_field form.video %}
						</div>
					</div>
					<div class="row">
						<div class="col-sm-3 col-md-offset-1">
							{% bootstrap_field form.imagen %}
						</div>
						<div class="col-sm-2">
							{% bootstrap_field form.calificacion %}
						</div>
						<div class="col-sm-2 col-md-offset-1">
							{% bootstrap_field form.is_active %}
						</div>
						<div class="col-sm-3">
							{% bootstrap_field form.is_estreno %}
						</div>
					</div>
					<div class="row">
						<div class="col-sm-3">
							<img id="imgSalida" width="40%" height="40%" src="">
						</div>
					</div>
					<button type="submit" class="btn btn-success btn-raised">Registrar</button>
				</form>
			</div>
		</div>
	</div>


	<div class="col-md-12">
		<div class="box box-primary">
			<div class="box-header">
				<h3 class="box-title">Listado de peliculas</h3>
			</div>
			<div class="box-body">
				<table id="tabla_peliculas" class="table table-striped table-bordered table-responsive">
					<thead>
					<tr>
						<th>Nombre</th>
						<th>Director</th>
						<th>Género</th>
						<th>Tipo</th>
						<th>Calificación</th>
						<th>Estado</th>
						<th>Acciones</th>
					</tr>
					</thead>
					<tbody>
					{% for pelicula in peliculas %}
						<tr>
							<td>{{ pelicula.nombre }}</td>
							<td>{{ pelicula.nombre_director }}</td>
							<td>
								{% for gen in pelicula.genero.all %} {{ gen }}, {% endfor %}
							</td>
							<td>
								{% if pelicula.is_estreno %} <span class="badge bg-green">Cartelera</span>
								{% else %} <span class="badge bg-yellow">Próximo estreno</span>
								{% endif %}
							</td>
							<td>{{ pelicula.calificacion }}</td>
							<td>
								{% if pelicula.is_active %} <span class="badge bg-green">Activo</span>
								{% else %} <span class="badge bg-red">Inactivo</span>
								{% endif %}
							</td>
							<td>


								<div class="btn-group">
									<button type="button" class="btn btn-info dropdown-toggle" data-toggle="dropdown"
									        aria-expanded="false">
										<span class="caret"></span>
										<div class="ripple-container"></div>
										Opciones
									</button>
									<ul class="dropdown-menu">
										<li><a href="{% url 'peliculas:editar_pelicula' pelicula.id %}">Editar
											pelicula</a></li>
										<li><a class="dropdown-item"
										       href="{% url 'peliculas:ver_pelicula' pelicula.slug %}">Ver película</a>
										</li>
									</ul>
								</div>

							</td>
						</tr>
					{% endfor %}

					</tbody>
				</table>

			</div>
		</div>
	</div>


{% endblock contenido %}

{% block js %}
	<script src="{% static 'dist/js/validacion_pelicula.js' %}"></script>
	<script src="{% static 'bower_components/datatables.net/js/jquery.dataTables.min.js' %}"></script>
	<script src="{% static 'bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js' %}"></script>
	<script src="{% static 'bower_components/datatables.net-bs/responsive/dataTables.responsive.min.js' %}"></script>
	{{ form.media.js }}
	<script type="text/javascript">
        $(function () {
            $('#tabla_peliculas').DataTable({
								"responsive": true,
                "pageLength": 5,
                "lengthChange": false,
                "info": false,
                "pagingType": "simple",
                "language": {
                    "url": "{% static 'bower_components/datatables.net/spanish.json' %}"
                }
            })
        });

        $('#imgSalida').attr("hidden", true);
        $(function () {
            $('#id_imagen').change(function (e) {
                $('#imgSalida').attr("hidden", false);
                addImage(e);
            });

            function addImage(e) {
                var file = e.target.files[0],
                    imageType = /image.*/;

                if (!file.type.match(imageType))
                    return;

                var reader = new FileReader();
                reader.onload = fileOnload;
                reader.readAsDataURL(file);
            }

            function fileOnload(e) {
                var result = e.target.result;
                $('#imgSalida').attr("src", result);
            }
        });
	</script>

{% endblock js %}
